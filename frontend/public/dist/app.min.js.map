{"version":3,"sources":["app/app.ts","app/load_starting_info_service.ts","app/login_service.ts","home/home.ts","home/home_no_login.ts","home/home_with_login.ts","startPage/start_page.ts"],"names":["angular","module","config","$locationProvider","html5Mode","app","startloading","CurrentUser","StartLoadingService","$http","this","informationLoaded","loggedUserInfo","undefined","console","log","prototype","sleep","miliseconds","currentTime","Date","getTime","loadUserInfo","username","_this","url","get","then","response","data","service","loginservice","ResponseToken","token","LoginService","$localStorage","$cookies","isLogged","loggedUser","checkIfLogged","getIsLogged","isLoggedLocalStorage","bearerCookie","checkTokenSync","http","XMLHttpRequest","open","setRequestHeader","send","status","login","user","stringUser","JSON","stringify","obtainedToken","parse","put","home","HomeCtrl","$scope","$routeProvider","when","templateUrl","controller","controllerAs","nolog","LoggingUser","password","HomeNoLogCtrl","$window","usernameLogin","passwordLogin","result","directive","withlog","HomeWithLogCtrl","StartPageCtrl"],"mappings":"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","file":"app.min.js","sourcesContent":["/// <reference path=\"../../../typings/index.d.ts\" />\n\nangular.module('imsFrontendApp', [\n    'app.home',\n    'app.home.nolog',\n    'app.home.withlog',\n    'app.loginservice',\n    'app.startloading',\n    'app.home.startpage',\n    'ngRoute'\n]).config(($locationProvider) => {\n    $locationProvider.html5Mode(true);\n});","/// <reference path=\"../../../typings/index.d.ts\" />\n\n/**\n * Created by fabriziomicheloni on 27/12/16.\n */\n\nmodule app.startloading {\n\n    'use strict';\n    import LoginService = app.loginservice.LoginService;\n    ///////////////////////////////////////////////////////\n    //                       MODELS                      //\n    ///////////////////////////////////////////////////////\n\n    export class CurrentUser {\n        username: string;\n        name: string;\n        surname: string;\n        dateOfBirth: Date;\n        country: string;\n        city: string;\n        picture: string;\n    }\n\n    ///////////////////////////////////////////////////////\n    //                     INTERFACES                    //\n    ///////////////////////////////////////////////////////\n\n    export interface IStartLoadingService {\n        loadUserInfo(username: string): void;\n        loggedUserInfo: CurrentUser;\n        informationLoaded: boolean;\n    }\n\n    ///////////////////////////////////////////////////////\n    //                      SERVICE                      //\n    ///////////////////////////////////////////////////////\n\n    export class StartLoadingService implements IStartLoadingService {\n\n        informationLoaded: boolean = false;\n\n        loggedUserInfo: app.startloading.CurrentUser = undefined;\n\n        constructor(public $http) {\n            console.log('Creating StartLoadingService...');\n        }\n\n        sleep(miliseconds: number): void {\n            var currentTime = new Date().getTime();\n            while (currentTime + miliseconds >= new Date().getTime()) {\n            }\n            this.informationLoaded = true;\n        }\n\n        loadUserInfo(username: string): void {\n            let url = '/api/account/user?username=' + username;\n            this.$http.get(url).then((response) => {\n                this.loggedUserInfo = response.data;\n                this.sleep(2000);\n            }, function (response) {\n                console.log('Error', response);\n            });\n        }\n    }\n\n    ///////////////////////////////////////////////////////\n    //                       ANGULAR                     //\n    ///////////////////////////////////////////////////////\n\n    angular\n        .module('app.startloading', [])\n        .service(\"StartLoadingService\", ['$http', StartLoadingService]);\n}\n","/// <reference path=\"../../../typings/index.d.ts\" />\n\n/**\n * Created by fabriziomicheloni on 27/12/16.\n */\n\nmodule app.loginservice {\n\n    'use strict';\n    import LoggingUser = app.home.nolog.LoggingUser;\n\n    ///////////////////////////////////////////////////////\n    //                       MODELS                      //\n    ///////////////////////////////////////////////////////\n\n    export class ResponseToken {\n        token: string;\n\n        constructor(token: string) {\n            this.token = token;\n        }\n    }\n\n    ///////////////////////////////////////////////////////\n    //                     INTERFACES                    //\n    ///////////////////////////////////////////////////////\n\n    export interface ILoginService {\n        isLogged: boolean;\n        getIsLogged(): boolean;\n        loggedUser: string;\n        checkIfLogged(): boolean;\n        checkTokenSync(token: string): boolean;\n        login(user: LoggingUser): boolean;\n    }\n\n    ///////////////////////////////////////////////////////\n    //                      SERVICE                      //\n    ///////////////////////////////////////////////////////\n\n    export class LoginService implements ILoginService {\n        isLogged: boolean = false;\n        loggedUser: string = undefined;\n\n        constructor(public $localStorage, public $cookies) {\n            console.log('Creating LoginService...');\n\n            this.isLogged = this.checkIfLogged();\n        }\n\n        getIsLogged(): boolean {\n            return this.isLogged;\n        }\n\n        public checkIfLogged(): boolean {\n            let isLoggedLocalStorage = this.$localStorage.isLogged;\n            let bearerCookie = this.$cookies.get('Bearer');\n\n            if (bearerCookie == null || isLoggedLocalStorage == null) {\n                console.log(\"Not logged \");\n                return false;\n            }\n\n            if (isLoggedLocalStorage != true) {\n                return false;\n            }\n\n            // TODO connect with the real api gateway\n            // return this.checkTokenSync(bearerCookie);\n            return true;\n        }\n\n        public checkTokenSync(token: string): boolean {\n            if (token == null) {\n                return false;\n            }\n\n            let http = new XMLHttpRequest();\n            let url = '/api/authentication/validate';\n            http.open(\"POST\", url, false);\n            http.setRequestHeader('Content-Type', 'application/txt');\n\n            // TODO connect with the real api gateway\n            http.send('eyJhbGciOiJIUzUxMiJ9.' +\n                'eyJzdWIiOiJSaWNoYXJkMDEyIiwiY3JlYXRlZCI6MTQ4MTU4NDA5ODE1NywiZXhwIjoxNDg0MTc2MDk4fQ.' +\n                '0-cTOpZXwz7FewssjHpfXbWnr6JDUYX7B1ZbT3OPU6ude3MzA21obWA6VRtfysAwFSwIYXtSDINqDRM1EbTFJw');\n\n            return http.status == 200;\n        }\n\n        login(user: LoggingUser): boolean {\n            let stringUser: string = JSON.stringify(user);\n            let http = new XMLHttpRequest();\n            let url = 'http://localhost/api/authentication/auth';\n            http.open(\"POST\", url, false);\n            http.setRequestHeader('Content-Type', 'application/json');\n\n            console.log(\"Logging in...\", stringUser);\n            http.send(stringUser);\n\n            if (http.status != 200) {\n                return false;\n            }\n\n            let obtainedToken: ResponseToken = JSON.parse(http.response);\n\n            this.$cookies.put('Bearer', obtainedToken.token);\n\n            this.isLogged = true;\n\n            this.loggedUser = user.username;\n\n            console.log(user.username);\n\n            return true;\n        }\n    }\n\n    ///////////////////////////////////////////////////////\n    //                       ANGULAR                     //\n    ///////////////////////////////////////////////////////\n\n    angular\n        .module('app.loginservice', ['ngStorage', 'ngCookies'])\n        .service(\"LoginService\", ['$localStorage', '$cookies', LoginService]);\n}\n","/// <reference path=\"../../../typings/index.d.ts\" />\n\n/**\n * Created by fabriziomicheloni on 27/12/16.\n */\n\nmodule app.home {\n\n    'use strict';\n    import LoginService = app.loginservice.LoginService;\n    import ILoginService = app.loginservice.ILoginService;\n\n    ///////////////////////////////////////////////////////\n    //                     INTERFACES                    //\n    ///////////////////////////////////////////////////////\n\n    export interface IHomeCtrl {\n    }\n\n    ///////////////////////////////////////////////////////\n    //                     CONTROLLER                    //\n    ///////////////////////////////////////////////////////\n\n    export class HomeCtrl implements IHomeCtrl {\n        constructor(public $scope: ng.IScope, public $cookies, public LoginService: ILoginService) {\n        }\n    }\n\n    ///////////////////////////////////////////////////////\n    //                       ANGULAR                     //\n    ///////////////////////////////////////////////////////\n\n    angular\n        .module('app.home', ['ngRoute', 'ngCookies', 'app.loginservice'])\n        .config(($routeProvider) => {\n            $routeProvider.when('/', {\n                templateUrl: '../../views/home/home.html',\n                controller: HomeCtrl,\n                controllerAs: 'homeCtrl'\n            })\n        });\n}\n","/// <reference path=\"../../../typings/index.d.ts\" />\n\n/**\n * Created by fabriziomicheloni on 27/12/16.\n */\n\nmodule app.home.nolog {\n\n    'use strict';\n    import ILoginService = app.loginservice.ILoginService;\n\n    ///////////////////////////////////////////////////////\n    //                       MODELS                      //\n    ///////////////////////////////////////////////////////\n\n    export class LoggingUser {\n        username: string;\n        password: string;\n\n        constructor(username: string, password: string) {\n            this.username = username;\n            this.password = password;\n        }\n    }\n\n    ///////////////////////////////////////////////////////\n    //                     INTERFACES                    //\n    ///////////////////////////////////////////////////////\n\n    export interface IHomeNoLogCtrl {\n        login(): void;\n        usernameLogin: string;\n        passwordLogin: string;\n    }\n\n    ///////////////////////////////////////////////////////\n    //                    CONTROLLERS                    //\n    ///////////////////////////////////////////////////////\n\n    export class HomeNoLogCtrl implements IHomeNoLogCtrl {\n        private usernameLogin: string = \"\";\n        private passwordLogin: string = \"\";\n\n        constructor(public LoginService: ILoginService, public $window) {\n        }\n\n        public login(): void {\n            let user = new LoggingUser(this.usernameLogin, this.passwordLogin);\n            console.log(user);\n\n            let result: boolean =  this.LoginService.login(user);\n\n            console.log('Result of login is: ', result);\n\n            // if(result) {\n            //     this.$window.location.href = '/';\n            // } else {\n            // //    TODO show error message\n            // }\n        }\n    }\n\n    ///////////////////////////////////////////////////////\n    //                       ANGULAR                     //\n    ///////////////////////////////////////////////////////\n\n    angular\n        .module('app.home.nolog', ['app.loginservice', 'angularSpinner'])\n        .directive('homeNoLogDirective', () => {\n            return {\n                templateUrl: '../../views/home/home_no_login.html',\n                controller: HomeNoLogCtrl,\n                controllerAs: 'homeNoLogCtrl'\n            };\n        });\n}\n","/// <reference path=\"../../../typings/index.d.ts\" />\n\n/**\n * Created by fabriziomicheloni on 29/12/16.\n */\n\nmodule app.home.withlog {\n\n    'use strict';\n    import ILoginService = app.loginservice.ILoginService;\n    import IStartLoadingService = app.startloading.IStartLoadingService;\n    import CurrentUser = app.startloading.CurrentUser;\n\n    ///////////////////////////////////////////////////////\n    //                       MODELS                      //\n    ///////////////////////////////////////////////////////\n\n    // export class LoggingUser {\n    //     username: string;\n    //     password: string;\n    //\n    //     constructor(username: string, password: string) {\n    //         this.username = username;\n    //         this.password = password;\n    //     }\n    // }\n\n    ///////////////////////////////////////////////////////\n    //                     INTERFACES                    //\n    ///////////////////////////////////////////////////////\n\n    export interface IHomeWithLogCtrl {\n    }\n\n    ///////////////////////////////////////////////////////\n    //                    CONTROLLERS                    //\n    ///////////////////////////////////////////////////////\n\n    export class HomeWithLogCtrl implements IHomeWithLogCtrl {\n\n        constructor(public LoginService: ILoginService, public StartLoadingService: IStartLoadingService, public $window) {\n            if(!this.StartLoadingService.informationLoaded) {\n                console.log('Loading user information...');\n                this.StartLoadingService.loadUserInfo(LoginService.loggedUser);\n            }\n        }\n    }\n\n    ///////////////////////////////////////////////////////\n    //                       ANGULAR                     //\n    ///////////////////////////////////////////////////////\n\n    angular\n        .module('app.home.withlog', ['app.loginservice', 'app.startloading', 'angularSpinner'])\n        .directive('homeWithLogDirective', () => {\n            return {\n                templateUrl: '../../views/home/home_with_login.html',\n                controller: HomeWithLogCtrl,\n                controllerAs: 'homeWithLogCtrl'\n            };\n        });\n}\n","/// <reference path=\"../../../typings/index.d.ts\" />\n\n/**\n * Created by fabriziomicheloni on 03/01/17.\n */\n\nmodule app.home.withlog {\n\n    'use strict';\n    import ILoginService = app.loginservice.ILoginService;\n    import IStartLoadingService = app.startloading.IStartLoadingService;\n    import CurrentUser = app.startloading.CurrentUser;\n\n    ///////////////////////////////////////////////////////\n    //                       MODELS                      //\n    ///////////////////////////////////////////////////////\n\n    // export class LoggingUser {\n    //     username: string;\n    //     password: string;\n    //\n    //     constructor(username: string, password: string) {\n    //         this.username = username;\n    //         this.password = password;\n    //     }\n    // }\n\n    ///////////////////////////////////////////////////////\n    //                     INTERFACES                    //\n    ///////////////////////////////////////////////////////\n\n    export interface IStartPageCtrl {\n    }\n\n    ///////////////////////////////////////////////////////\n    //                    CONTROLLERS                    //\n    ///////////////////////////////////////////////////////\n\n    export class StartPageCtrl implements IStartPageCtrl {\n\n        constructor(public LoginService: ILoginService, public StartLoadingService: IStartLoadingService, public $window) {\n\n        }\n    }\n\n    ///////////////////////////////////////////////////////\n    //                       ANGULAR                     //\n    ///////////////////////////////////////////////////////\n\n    angular\n        .module('app.home.startpage', ['app.loginservice', 'app.startloading', 'angularSpinner'])\n        .directive('startPageDirective', () => {\n            return {\n                templateUrl: '../../views/startPage/startPage.html',\n                controller: StartPageCtrl,\n                controllerAs: 'startPageCtrl'\n            };\n        });\n}\n"]}